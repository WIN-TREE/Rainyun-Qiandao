name: Rainyun 自动签到

on:
  schedule:
    # 北京时间12：30点（UTC+8 04:30）- 主要执行时间
    - cron: '30 4 * * *'
  workflow_dispatch:  # 允许手动触发

jobs:
  sign-in:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: 设置Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'
      
      - name: 缓存Python依赖
        uses: actions/cache@v3
        with:
          path: ~/.cache/pip
          key: ${{ runner.os }}-python-${{ hashFiles('**/requirements.txt') }}
          restore-keys: |
            ${{ runner.os }}-python-
      
      - name: 安装依赖
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      - name: 安装Chrome和ChromeDriver
        run: |
          sudo apt-get update
          sudo apt-get install -y google-chrome-stable curl unzip
          pip install webdriver-manager chromedriver-binary-auto
      
      - name: 确保temp目录存在
        run: mkdir -p temp
      
      - name: 执行签到脚本
        run: python rainyun.py
        env:
          RAINYUN_USER: ${{ secrets.RAINYUN_USER }}
          RAINYUN_PASS: ${{ secrets.RAINYUN_PASS }}
          HEADLESS: "true"
          DEBUG: "false"
          CHROMEDRIVER_PATH: "chromedriver"
      
      - name: 清理临时文件
        run: rm -rf temp
        if: always()
